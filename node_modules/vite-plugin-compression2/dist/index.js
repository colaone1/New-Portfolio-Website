"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e,t,n,r,i,o,a,s,u,l,p,c,f=require("path"),h=require("fs"),d=require("node:fs/promises"),g=require("os"),y=require("stream"),b=require("util"),m=require("zlib");function E(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var A={};function R(){if(t)return e;t=1;let n="[^\\\\/]",r="[^/]",i="(?:\\/|$)",o="(?:^|\\/)",a=`\\.{1,2}${i}`,s=`(?!${o}${a})`,u=`(?!\\.{0,1}${i})`,l=`(?!${a})`,p=`${r}*?`,c={DOT_LITERAL:"\\.",PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:"\\/",ONE_CHAR:"(?=.)",QMARK:r,END_ANCHOR:i,DOTS_SLASH:a,NO_DOT:"(?!\\.)",NO_DOTS:s,NO_DOT_SLASH:u,NO_DOTS_SLASH:l,QMARK_NO_DOT:"[^.\\/]",STAR:p,START_ANCHOR:o},h={...c,SLASH_LITERAL:"[\\\\/]",QMARK:n,STAR:`${n}*?`,DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)"};return e={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:f.sep,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?h:c}}function x(){if(n)return A;n=1;let e="win32"===process.platform,{REGEX_BACKSLASH:t,REGEX_REMOVE_BACKSLASH:r,REGEX_SPECIAL_CHARS:i,REGEX_SPECIAL_CHARS_GLOBAL:o}=R();return A.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),A.hasRegexChars=e=>i.test(e),A.isRegexChar=e=>1===e.length&&A.hasRegexChars(e),A.escapeRegex=e=>e.replace(o,"\\$1"),A.toPosixSlashes=e=>e.replace(t,"/"),A.removeBackslashes=e=>e.replace(r,e=>"\\"===e?"":e),A.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return 3===e.length&&!!(e[0]>=9)||8===e[0]&&!!(e[1]>=10)},A.isWindows=t=>t&&"boolean"==typeof t.windows?t.windows:!0===e||"\\"===f.sep,A.escapeLast=(e,t,n)=>{let r=e.lastIndexOf(t,n);return -1===r?e:"\\"===e[r-1]?A.escapeLast(e,t,r-1):`${e.slice(0,r)}\\${e.slice(r)}`},A.removePrefix=(e,t={})=>{let n=e;return n.startsWith("./")&&(n=n.slice(2),t.prefix="./"),n},A.wrapOutput=(e,t={},n={})=>{let r=n.contains?"":"^",i=n.contains?"":"$",o=`${r}(?:${e})${i}`;return!0===t.negated&&(o=`(?:^(?!${o}).*$)`),o},A}var _=E(p?l:(p=1,l=function(){if(u)return s;u=1;let e=function(){if(i)return r;i=1;let e=x(),{CHAR_ASTERISK:t,CHAR_AT:n,CHAR_BACKWARD_SLASH:o,CHAR_COMMA:a,CHAR_DOT:s,CHAR_EXCLAMATION_MARK:u,CHAR_FORWARD_SLASH:l,CHAR_LEFT_CURLY_BRACE:p,CHAR_LEFT_PARENTHESES:c,CHAR_LEFT_SQUARE_BRACKET:f,CHAR_PLUS:h,CHAR_QUESTION_MARK:d,CHAR_RIGHT_CURLY_BRACE:g,CHAR_RIGHT_PARENTHESES:y,CHAR_RIGHT_SQUARE_BRACKET:b}=R(),m=e=>e===l||e===o,E=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};return r=(r,i)=>{let A,R,x=i||{},_=r.length-1,v=!0===x.parts||!0===x.scanToEnd,$=[],C=[],w=[],O=r,S=-1,k=0,I=0,T=!1,N=!1,H=!1,L=!1,P=!1,M=!1,D=!1,B=!1,G=!1,U=!1,j=0,F={value:"",depth:0,isGlob:!1},q=()=>S>=_,K=()=>O.charCodeAt(S+1),W=()=>(A=R,O.charCodeAt(++S));for(;S<_;){let e;if((R=W())===o){D=F.backslashes=!0,(R=W())===p&&(M=!0);continue}if(!0===M||R===p){for(j++;!0!==q()&&(R=W());){if(R===o){D=F.backslashes=!0,W();continue}if(R===p){j++;continue}if(!0!==M&&R===s&&(R=W())===s||!0!==M&&R===a){if(T=F.isBrace=!0,H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===g&&0==--j){M=!1,T=F.isBrace=!0,U=!0;break}}if(!0===v)continue;break}if(R===l){if($.push(S),C.push(F),F={value:"",depth:0,isGlob:!1},!0===U)continue;if(A===s&&S===k+1){k+=2;continue}I=S+1;continue}if(!0!==x.noext&&!0==(R===h||R===n||R===t||R===d||R===u)&&K()===c){if(H=F.isGlob=!0,L=F.isExtglob=!0,U=!0,R===u&&S===k&&(G=!0),!0===v){for(;!0!==q()&&(R=W());){if(R===o){D=F.backslashes=!0,R=W();continue}if(R===y){H=F.isGlob=!0,U=!0;break}}continue}break}if(R===t){if(A===t&&(P=F.isGlobstar=!0),H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===d){if(H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===f){for(;!0!==q()&&(e=W());){if(e===o){D=F.backslashes=!0,W();continue}if(e===b){N=F.isBracket=!0,H=F.isGlob=!0,U=!0;break}}if(!0===v)continue;break}if(!0!==x.nonegate&&R===u&&S===k){B=F.negated=!0,k++;continue}if(!0!==x.noparen&&R===c){if(H=F.isGlob=!0,!0===v){for(;!0!==q()&&(R=W());){if(R===c){D=F.backslashes=!0,R=W();continue}if(R===y){U=!0;break}}continue}break}if(!0===H){if(U=!0,!0===v)continue;break}}!0===x.noext&&(L=!1,H=!1);let z=O,V="",X="";k>0&&(V=O.slice(0,k),O=O.slice(k),I-=k),z&&!0===H&&I>0?(z=O.slice(0,I),X=O.slice(I)):!0===H?(z="",X=O):z=O,z&&""!==z&&"/"!==z&&z!==O&&m(z.charCodeAt(z.length-1))&&(z=z.slice(0,-1)),!0===x.unescape&&(X&&(X=e.removeBackslashes(X)),z&&!0===D&&(z=e.removeBackslashes(z)));let Q={prefix:V,input:r,start:k,base:z,glob:X,isBrace:T,isBracket:N,isGlob:H,isExtglob:L,isGlobstar:P,negated:B,negatedExtglob:G};if(!0===x.tokens&&(Q.maxDepth=0,m(R)||C.push(F),Q.tokens=C),!0===x.parts||!0===x.tokens){let e;for(let t=0;t<$.length;t++){let n=e?e+1:k,i=$[t],o=r.slice(n,i);x.tokens&&(0===t&&0!==k?(C[t].isPrefix=!0,C[t].value=V):C[t].value=o,E(C[t]),Q.maxDepth+=C[t].depth),(0!==t||""!==o)&&w.push(o),e=i}if(e&&e+1<r.length){let t=r.slice(e+1);w.push(t),x.tokens&&(C[C.length-1].value=t,E(C[C.length-1]),Q.maxDepth+=C[C.length-1].depth)}Q.slashes=$,Q.parts=w}return Q}}(),t=function(){if(a)return o;a=1;let e=R(),t=x(),{MAX_LENGTH:n,POSIX_REGEX_SOURCE:r,REGEX_NON_SPECIAL_CHARS:i,REGEX_SPECIAL_CHARS_BACKREF:s,REPLACEMENTS:u}=e,l=(e,n)=>{if("function"==typeof n.expandRange)return n.expandRange(...e,n);e.sort();let r=`[${e.join("-")}]`;try{new RegExp(r)}catch(n){return e.map(e=>t.escapeRegex(e)).join("..")}return r},p=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,c=(o,a)=>{let f;if("string"!=typeof o)throw TypeError("Expected a string");o=u[o]||o;let h={...a},d="number"==typeof h.maxLength?Math.min(n,h.maxLength):n,g=o.length;if(g>d)throw SyntaxError(`Input length: ${g}, exceeds maximum allowed length: ${d}`);let y={type:"bos",value:"",output:h.prepend||""},b=[y],m=h.capture?"":"?:",E=t.isWindows(a),A=e.globChars(E),R=e.extglobChars(A),{DOT_LITERAL:x,PLUS_LITERAL:_,SLASH_LITERAL:v,ONE_CHAR:$,DOTS_SLASH:C,NO_DOT:w,NO_DOT_SLASH:O,NO_DOTS_SLASH:S,QMARK:k,QMARK_NO_DOT:I,STAR:T,START_ANCHOR:N}=A,H=e=>`(${m}(?:(?!${N}${e.dot?C:x}).)*?)`,L=h.dot?"":w,P=h.dot?k:I,M=!0===h.bash?H(h):T;h.capture&&(M=`(${M})`),"boolean"==typeof h.noext&&(h.noextglob=h.noext);let D={input:o,index:-1,start:0,dot:!0===h.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:b};g=(o=t.removePrefix(o,D)).length;let B=[],G=[],U=[],j=y,F=()=>D.index===g-1,q=D.peek=(e=1)=>o[D.index+e],K=D.advance=()=>o[++D.index]||"",W=()=>o.slice(D.index+1),z=(e="",t=0)=>{D.consumed+=e,D.index+=t},V=e=>{D.output+=null!=e.output?e.output:e.value,z(e.value)},X=()=>{let e=1;for(;"!"===q()&&("("!==q(2)||"?"===q(3));)K(),D.start++,e++;return e%2!=0&&(D.negated=!0,D.start++,!0)},Q=e=>{D[e]++,U.push(e)},Y=e=>{D[e]--,U.pop()},Z=e=>{if("globstar"===j.type){let t=D.braces>0&&("comma"===e.type||"brace"===e.type),n=!0===e.extglob||B.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||n||(D.output=D.output.slice(0,-j.output.length),j.type="star",j.value="*",j.output=M,D.output+=j.output)}if(B.length&&"paren"!==e.type&&(B[B.length-1].inner+=e.value),(e.value||e.output)&&V(e),j&&"text"===j.type&&"text"===e.type){j.value+=e.value,j.output=(j.output||"")+e.value;return}e.prev=j,b.push(e),j=e},J=(e,t)=>{let n={...R[t],conditions:1,inner:""};n.prev=j,n.parens=D.parens,n.output=D.output;let r=(h.capture?"(":"")+n.open;Q("parens"),Z({type:e,value:t,output:D.output?"":$}),Z({type:"paren",extglob:!0,value:K(),output:r}),B.push(n)},ee=e=>{let t,n=e.close+(h.capture?")":"");if("negate"===e.type){let r=M;if(e.inner&&e.inner.length>1&&e.inner.includes("/")&&(r=H(h)),(r!==M||F()||/^\)+$/.test(W()))&&(n=e.close=`)$))${r}`),e.inner.includes("*")&&(t=W())&&/^\.[^\\/.]+$/.test(t)){let i=c(t,{...a,fastpaths:!1}).output;n=e.close=`)${i})${r})`}"bos"===e.prev.type&&(D.negatedExtglob=!0)}Z({type:"paren",extglob:!0,value:f,output:n}),Y("parens")};if(!1!==h.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(o)){let e=!1,n=o.replace(s,(t,n,r,i,o,a)=>"\\"===i?(e=!0,t):"?"===i?n?n+i+(o?k.repeat(o.length):""):0===a?P+(o?k.repeat(o.length):""):k.repeat(r.length):"."===i?x.repeat(r.length):"*"===i?n?n+i+(o?M:""):M:n?t:`\\${t}`);return(!0===e&&(n=!0===h.unescape?n.replace(/\\/g,""):n.replace(/\\+/g,e=>e.length%2==0?"\\\\":e?"\\":"")),n===o&&!0===h.contains)?D.output=o:D.output=t.wrapOutput(n,D,a),D}for(;!F();){if("\0"===(f=K()))continue;if("\\"===f){let e=q();if("/"===e&&!0!==h.bash||"."===e||";"===e)continue;if(!e){Z({type:"text",value:f+="\\"});continue}let t=/^\\+/.exec(W()),n=0;if(t&&t[0].length>2&&(n=t[0].length,D.index+=n,n%2!=0&&(f+="\\")),!0===h.unescape?f=K():f+=K(),0===D.brackets){Z({type:"text",value:f});continue}}if(D.brackets>0&&("]"!==f||"["===j.value||"[^"===j.value)){if(!1!==h.posix&&":"===f){let e=j.value.slice(1);if(e.includes("[")&&(j.posix=!0,e.includes(":"))){let e=j.value.lastIndexOf("["),t=j.value.slice(0,e),n=r[j.value.slice(e+2)];if(n){j.value=t+n,D.backtrack=!0,K(),y.output||1!==b.indexOf(j)||(y.output=$);continue}}}("["===f&&":"!==q()||"-"===f&&"]"===q())&&(f=`\\${f}`),"]"===f&&("["===j.value||"[^"===j.value)&&(f=`\\${f}`),!0===h.posix&&"!"===f&&"["===j.value&&(f="^"),j.value+=f,V({value:f});continue}if(1===D.quotes&&'"'!==f){f=t.escapeRegex(f),j.value+=f,V({value:f});continue}if('"'===f){D.quotes=+(1!==D.quotes),!0===h.keepQuotes&&Z({type:"text",value:f});continue}if("("===f){Q("parens"),Z({type:"paren",value:f});continue}if(")"===f){if(0===D.parens&&!0===h.strictBrackets)throw SyntaxError(p("opening","("));let e=B[B.length-1];if(e&&D.parens===e.parens+1){ee(B.pop());continue}Z({type:"paren",value:f,output:D.parens?")":"\\)"}),Y("parens");continue}if("["===f){if(!0!==h.nobracket&&W().includes("]"))Q("brackets");else{if(!0!==h.nobracket&&!0===h.strictBrackets)throw SyntaxError(p("closing","]"));f=`\\${f}`}Z({type:"bracket",value:f});continue}if("]"===f){if(!0===h.nobracket||j&&"bracket"===j.type&&1===j.value.length){Z({type:"text",value:f,output:`\\${f}`});continue}if(0===D.brackets){if(!0===h.strictBrackets)throw SyntaxError(p("opening","["));Z({type:"text",value:f,output:`\\${f}`});continue}Y("brackets");let e=j.value.slice(1);if(!0===j.posix||"^"!==e[0]||e.includes("/")||(f=`/${f}`),j.value+=f,V({value:f}),!1===h.literalBrackets||t.hasRegexChars(e))continue;let n=t.escapeRegex(j.value);if(D.output=D.output.slice(0,-j.value.length),!0===h.literalBrackets){D.output+=n,j.value=n;continue}j.value=`(${m}${n}|${j.value})`,D.output+=j.value;continue}if("{"===f&&!0!==h.nobrace){Q("braces");let e={type:"brace",value:f,output:"(",outputIndex:D.output.length,tokensIndex:D.tokens.length};G.push(e),Z(e);continue}if("}"===f){let e=G[G.length-1];if(!0===h.nobrace||!e){Z({type:"text",value:f,output:f});continue}let t=")";if(!0===e.dots){let e=b.slice(),n=[];for(let t=e.length-1;t>=0&&(b.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&n.unshift(e[t].value);t=l(n,h),D.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){let n=D.output.slice(0,e.outputIndex),r=D.tokens.slice(e.tokensIndex);for(let i of(e.value=e.output="\\{",f=t="\\}",D.output=n,r))D.output+=i.output||i.value}Z({type:"brace",value:f,output:t}),Y("braces"),G.pop();continue}if("|"===f){B.length>0&&B[B.length-1].conditions++,Z({type:"text",value:f});continue}if(","===f){let e=f,t=G[G.length-1];t&&"braces"===U[U.length-1]&&(t.comma=!0,e="|"),Z({type:"comma",value:f,output:e});continue}if("/"===f){if("dot"===j.type&&D.index===D.start+1){D.start=D.index+1,D.consumed="",D.output="",b.pop(),j=y;continue}Z({type:"slash",value:f,output:v});continue}if("."===f){if(D.braces>0&&"dot"===j.type){"."===j.value&&(j.output=x);let e=G[G.length-1];j.type="dots",j.output+=f,j.value+=f,e.dots=!0;continue}if(D.braces+D.parens===0&&"bos"!==j.type&&"slash"!==j.type){Z({type:"text",value:f,output:x});continue}Z({type:"dot",value:f,output:x});continue}if("?"===f){if(!(j&&"("===j.value)&&!0!==h.noextglob&&"("===q()&&"?"!==q(2)){J("qmark",f);continue}if(j&&"paren"===j.type){let e=q(),n=f;if("<"===e&&!t.supportsLookbehinds())throw Error("Node.js v10 or higher is required for regex lookbehinds");("("!==j.value||/[!=<:]/.test(e))&&("<"!==e||/<([!=]|\w+>)/.test(W()))||(n=`\\${f}`),Z({type:"text",value:f,output:n});continue}if(!0!==h.dot&&("slash"===j.type||"bos"===j.type)){Z({type:"qmark",value:f,output:I});continue}Z({type:"qmark",value:f,output:k});continue}if("!"===f){if(!0!==h.noextglob&&"("===q()&&("?"!==q(2)||!/[!=<:]/.test(q(3)))){J("negate",f);continue}if(!0!==h.nonegate&&0===D.index){X();continue}}if("+"===f){if(!0!==h.noextglob&&"("===q()&&"?"!==q(2)){J("plus",f);continue}if(j&&"("===j.value||!1===h.regex){Z({type:"plus",value:f,output:_});continue}if(j&&("bracket"===j.type||"paren"===j.type||"brace"===j.type)||D.parens>0){Z({type:"plus",value:f});continue}Z({type:"plus",value:_});continue}if("@"===f){if(!0!==h.noextglob&&"("===q()&&"?"!==q(2)){Z({type:"at",extglob:!0,value:f,output:""});continue}Z({type:"text",value:f});continue}if("*"!==f){("$"===f||"^"===f)&&(f=`\\${f}`);let e=i.exec(W());e&&(f+=e[0],D.index+=e[0].length),Z({type:"text",value:f});continue}if(j&&("globstar"===j.type||!0===j.star)){j.type="star",j.star=!0,j.value+=f,j.output=M,D.backtrack=!0,D.globstar=!0,z(f);continue}let e=W();if(!0!==h.noextglob&&/^\([^?]/.test(e)){J("star",f);continue}if("star"===j.type){if(!0===h.noglobstar){z(f);continue}let t=j.prev,n=t.prev,r="slash"===t.type||"bos"===t.type,i=n&&("star"===n.type||"globstar"===n.type);if(!0===h.bash&&(!r||e[0]&&"/"!==e[0])){Z({type:"star",value:f,output:""});continue}let a=D.braces>0&&("comma"===t.type||"brace"===t.type),s=B.length&&("pipe"===t.type||"paren"===t.type);if(!r&&"paren"!==t.type&&!a&&!s){Z({type:"star",value:f,output:""});continue}for(;"/**"===e.slice(0,3);){let t=o[D.index+4];if(t&&"/"!==t)break;e=e.slice(3),z("/**",3)}if("bos"===t.type&&F()){j.type="globstar",j.value+=f,j.output=H(h),D.output=j.output,D.globstar=!0,z(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&!i&&F()){D.output=D.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=H(h)+(h.strictSlashes?")":"|$)"),j.value+=f,D.globstar=!0,D.output+=t.output+j.output,z(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&"/"===e[0]){let n=void 0!==e[1]?"|$":"";D.output=D.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=`${H(h)}${v}|${v}${n})`,j.value+=f,D.output+=t.output+j.output,D.globstar=!0,z(f+K()),Z({type:"slash",value:"/",output:""});continue}if("bos"===t.type&&"/"===e[0]){j.type="globstar",j.value+=f,j.output=`(?:^|${v}|${H(h)}${v})`,D.output=j.output,D.globstar=!0,z(f+K()),Z({type:"slash",value:"/",output:""});continue}D.output=D.output.slice(0,-j.output.length),j.type="globstar",j.output=H(h),j.value+=f,D.output+=j.output,D.globstar=!0,z(f);continue}let n={type:"star",value:f,output:M};if(!0===h.bash){n.output=".*?",("bos"===j.type||"slash"===j.type)&&(n.output=L+n.output),Z(n);continue}if(j&&("bracket"===j.type||"paren"===j.type)&&!0===h.regex){n.output=f,Z(n);continue}(D.index===D.start||"slash"===j.type||"dot"===j.type)&&("dot"===j.type?(D.output+=O,j.output+=O):!0===h.dot?(D.output+=S,j.output+=S):(D.output+=L,j.output+=L),"*"!==q()&&(D.output+=$,j.output+=$)),Z(n)}for(;D.brackets>0;){if(!0===h.strictBrackets)throw SyntaxError(p("closing","]"));D.output=t.escapeLast(D.output,"["),Y("brackets")}for(;D.parens>0;){if(!0===h.strictBrackets)throw SyntaxError(p("closing",")"));D.output=t.escapeLast(D.output,"("),Y("parens")}for(;D.braces>0;){if(!0===h.strictBrackets)throw SyntaxError(p("closing","}"));D.output=t.escapeLast(D.output,"{"),Y("braces")}if(!0!==h.strictSlashes&&("star"===j.type||"bracket"===j.type)&&Z({type:"maybe_slash",value:"",output:`${v}?`}),!0===D.backtrack)for(let e of(D.output="",D.tokens))D.output+=null!=e.output?e.output:e.value,e.suffix&&(D.output+=e.suffix);return D};return c.fastpaths=(r,i)=>{let o={...i},a="number"==typeof o.maxLength?Math.min(n,o.maxLength):n,s=r.length;if(s>a)throw SyntaxError(`Input length: ${s}, exceeds maximum allowed length: ${a}`);r=u[r]||r;let l=t.isWindows(i),{DOT_LITERAL:p,SLASH_LITERAL:c,ONE_CHAR:f,DOTS_SLASH:h,NO_DOT:d,NO_DOTS:g,NO_DOTS_SLASH:y,STAR:b,START_ANCHOR:m}=e.globChars(l),E=o.dot?g:d,A=o.dot?y:d,R=o.capture?"":"?:",x=!0===o.bash?".*?":b;o.capture&&(x=`(${x})`);let _=e=>!0===e.noglobstar?x:`(${R}(?:(?!${m}${e.dot?h:p}).)*?)`,v=e=>{switch(e){case"*":return`${E}${f}${x}`;case".*":return`${p}${f}${x}`;case"*.*":return`${E}${x}${p}${f}${x}`;case"*/*":return`${E}${x}${c}${f}${A}${x}`;case"**":return E+_(o);case"**/*":return`(?:${E}${_(o)}${c})?${A}${f}${x}`;case"**/*.*":return`(?:${E}${_(o)}${c})?${A}${x}${p}${f}${x}`;case"**/.*":return`(?:${E}${_(o)}${c})?${p}${f}${x}`;default:{let t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;let n=v(t[1]);if(!n)return;return n+p+t[2]}}},$=v(t.removePrefix(r,{negated:!1,prefix:""}));return $&&!0!==o.strictSlashes&&($+=`${c}?`),$},o=c}(),n=x(),l=R(),p=e=>e&&"object"==typeof e&&!Array.isArray(e),c=(e,t,r=!1)=>{if(Array.isArray(e)){let n=e.map(e=>c(e,t,r));return e=>{for(let t of n){let n=t(e);if(n)return n}return!1}}let i=p(e)&&e.tokens&&e.input;if(""===e||"string"!=typeof e&&!i)throw TypeError("Expected pattern to be a non-empty string");let o=t||{},a=n.isWindows(t),s=i?c.compileRe(e,t):c.makeRe(e,t,!1,!0),u=s.state;delete s.state;let l=()=>!1;if(o.ignore){let e={...t,ignore:null,onMatch:null,onResult:null};l=c(o.ignore,e,r)}let f=(n,r=!1)=>{let{isMatch:i,match:p,output:f}=c.test(n,s,t,{glob:e,posix:a}),h={glob:e,state:u,regex:s,posix:a,input:n,output:f,match:p,isMatch:i};return("function"==typeof o.onResult&&o.onResult(h),!1===i)?(h.isMatch=!1,!!r&&h):l(n)?("function"==typeof o.onIgnore&&o.onIgnore(h),h.isMatch=!1,!!r&&h):("function"==typeof o.onMatch&&o.onMatch(h),!r||h)};return r&&(f.state=u),f};return c.test=(e,t,r,{glob:i,posix:o}={})=>{if("string"!=typeof e)throw TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};let a=r||{},s=a.format||(o?n.toPosixSlashes:null),u=e===i,l=u&&s?s(e):e;return!1===u&&(u=(l=s?s(e):e)===i),(!1===u||!0===a.capture)&&(u=!0===a.matchBase||!0===a.basename?c.matchBase(e,t,r,o):t.exec(l)),{isMatch:!!u,match:u,output:l}},c.matchBase=(e,t,r,i=n.isWindows(r))=>(t instanceof RegExp?t:c.makeRe(t,r)).test(f.basename(e)),c.isMatch=(e,t,n)=>c(t,n)(e),c.parse=(e,n)=>Array.isArray(e)?e.map(e=>c.parse(e,n)):t(e,{...n,fastpaths:!1}),c.scan=(t,n)=>e(t,n),c.compileRe=(e,t,n=!1,r=!1)=>{if(!0===n)return e.output;let i=t||{},o=i.contains?"":"^",a=i.contains?"":"$",s=`${o}(?:${e.output})${a}`;e&&!0===e.negated&&(s=`^(?!${s}).*$`);let u=c.toRegex(s,t);return!0===r&&(u.state=e),u},c.makeRe=(e,n={},r=!1,i=!1)=>{if(!e||"string"!=typeof e)throw TypeError("Expected a non-empty string");let o={negated:!1,fastpaths:!0};return!1!==n.fastpaths&&("."===e[0]||"*"===e[0])&&(o.output=t.fastpaths(e,n)),o.output||(o=t(e,n)),c.compileRe(o,n,r,i)},c.toRegex=(e,t)=>{try{let n=t||{};return new RegExp(e,n.flags||(n.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},c.constants=l,s=c}()));function v(e){return Array.isArray(e)?e:null==e?[]:[e]}const $=RegExp(`\\${f.win32.sep}`,"g"),C=function(e){return e.replace($,f.posix.sep)},w=function(e,t,n){let r=n&&n.resolve,i=e=>e instanceof RegExp?e:{test:t=>_(function(e,t){if(!1===t||f.isAbsolute(e)||e.startsWith("**"))return C(e);let n=C(f.resolve(t||"")).replace(/[-^$*+?.()|[\]{}]/g,"\\$&");return f.posix.join(n,C(e))}(e,r),{dot:!0})(t)},o=v(e).map(i),a=v(t).map(i);return o.length||a.length?function(e){if("string"!=typeof e||e.includes("\0"))return!1;let t=C(e);for(let e=0;e<a.length;++e)if(a[e].test(t))return!1;for(let e=0;e<o.length;++e)if(o[e].test(t))return!0;return!o.length}:e=>"string"==typeof e&&!e.includes("\0")};new Set("break case class catch const continue debugger default delete do else export extends finally for function if import in instanceof let new return super switch this throw try typeof var void while with yield enum await implements package protected static interface private public arguments Infinity NaN undefined null true false eval uneval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Symbol Error EvalError InternalError RangeError ReferenceError SyntaxError TypeError URIError Number Math Date String RegExp Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array Map Set WeakMap WeakSet SIMD ArrayBuffer DataView JSON Promise Generator GeneratorFunction Reflect Proxy Intl".split(" ")).add("");var O={exports:{}},S=E(function(){if(c)return O.exports;c=1;let e,t,n,{defineProperty:r,setPrototypeOf:i,create:o,keys:a}=Object,{round:s,max:u}=Math,l=e=>{let t=/([a-f\d]{3,6})/i.exec(e)?.[1],n=t?.length,r=parseInt(6^n?3^n?"0":t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:t,16);return[r>>16&255,r>>8&255,255&r]},p=(e,t,n)=>e^t||t^n?16+36*s(e/51)+6*s(t/51)+s(n/51):8>e?16:e>248?231:s(24*(e-8)/247)+232,f=e=>{let t,n,r,i,o;return 8>e?30+e:16>e?e-8+90:(232>e?(o=(e-=16)%36,t=(e/36|0)/5,n=(o/6|0)/5,r=o%6/5):t=n=r=(10*(e-232)+8)/255,(i=2*u(t,n,r))?30+(s(r)<<2|s(n)<<1|s(t))+(2^i?0:60):30)},h=(()=>{let n,r,i,o=e=>l.some(t=>e.test(t)),s=globalThis,u=s.process??{},l=u.argv??[],p=u.env??{},c=-1;try{e=","+a(p).join(",")}catch(e){p={},c=0}let f="FORCE_COLOR",h={false:0,0:0,1:1,2:2,3:3}[p[f]]??-1,d=f in p&&h||o(/^--color=?(true|always)?$/);return d&&(c=h),~c||(n=p,r=!!p.PM2_HOME||p.NEXT_RUNTIME?.includes("edge")||!!u.stdout?.isTTY,i="win32"===u.platform,t=n.TERM,c=({"24bit":3,truecolor:3,ansi256:2,ansi:1})[n.COLORTERM]||(n.CI?/,GITHUB/.test(e)?3:1:r&&"dumb"!==t?i?3:/-256/.test(t)?2:1:0)),!h||p.NO_COLOR||o(/^--(no-color|color=(false|never))$/)?0:s.window?.chrome||d&&!c?3:c})(),d={open:"",close:""},g={},y=({p:e},{open:t,close:r})=>{let o=(e,...n)=>{if(!e){if(t&&t===r)return t;if((e??"")==="")return""}let i,a=e.raw?String.raw({raw:e},...n):""+e,s=o.p,u=s.o,l=s.c;if(a.includes("\x1b"))for(;s;s=s.p){let{open:e,close:t}=s,n=t.length,r="",o=0;if(n)for(;~(i=a.indexOf(t,o));o=i+n)r+=a.slice(o,i)+e;a=r+a.slice(o)}return u+(a.includes("\n")?a.replace(/(\r?\n)/g,l+"$1"+u):a)+l},a=t,s=r;return e&&(a=e.o+t,s=r+e.c),i(o,n),o.p={open:t,close:r,o:a,c:s,p:e},o.open=a,o.close=s,o},b=function(e=h){let t={Ansis:b,isSupported:()=>a,strip:e=>e.replace(/[][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""),extend(e){for(let t in e){let n=e[t],i=(typeof n)[0],o="s"===i?A(...l(n)):n;g[t]="f"===i?{get(){return(...e)=>y(this,n(...e))}}:{get(){let e=y(this,o);return r(this,t,{value:e}),e}}}return i(t,n=o({},g)),t}},a=e>0,s=(e,t)=>a?{open:`[${e}m`,close:`[${t}m`}:d,u=e=>t=>e(...l(t)),c=(e,t)=>(n,r,i)=>s(`${e}8;2;${n};${r};${i}`,t),m=(e,t)=>(n,r,i)=>s(f(p(n,r,i))+e,t),E=e=>(t,n,r)=>e(p(t,n,r)),A=c(3,39),R=c(4,49),x=e=>s("38;5;"+e,39),_=e=>s("48;5;"+e,49);2===e?(A=E(x),R=E(_)):1===e&&(A=m(0,39),R=m(10,49),x=e=>s(f(e),39),_=e=>s(f(e)+10,49));let v,$={fg:x,bg:_,rgb:A,bgRgb:R,hex:u(A),bgHex:u(R),visible:d,reset:s(0,0),bold:s(1,22),dim:s(2,22),italic:s(3,23),underline:s(4,24),inverse:s(7,27),hidden:s(8,28),strikethrough:s(9,29)},C="Bright";return"black,red,green,yellow,blue,magenta,cyan,white,gray".split(",").map((e,t)=>{v="bg"+e[0].toUpperCase()+e.slice(1),8>t?($[e+C]=s(90+t,39),$[v+C]=s(100+t,49)):t=60,$[e]=s(30+t,39),$[v]=s(40+t,49)}),t.extend($)},m=new b;return O.exports=m,m.default=m,O.exports}());const{Ansis:k,fg:I,bg:T,rgb:N,bgRgb:H,hex:L,bgHex:P,reset:M,inverse:D,hidden:B,visible:G,bold:U,dim:j,italic:F,underline:q,strikethrough:K,black:W,red:z,green:V,yellow:X,blue:Q,magenta:Y,cyan:Z,white:J,gray:ee,redBright:et,greenBright:en,yellowBright:er,blueBright:ei,magentaBright:eo,cyanBright:ea,whiteBright:es,bgBlack:eu,bgRed:el,bgGreen:ep,bgYellow:ec,bgBlue:ef,bgMagenta:eh,bgCyan:ed,bgWhite:eg,bgGray:ey,bgRedBright:eb,bgGreenBright:em,bgYellowBright:eE,bgBlueBright:eA,bgMagentaBright:eR,bgCyanBright:ex,bgWhiteBright:e_}=S;let ev={REG_TYPE:"0",DIR_TYPE:"5",XHD_TYPE:"x"},e$={T_MAGIC:"ustar",T_VERSION:"00",WHITE_SPACE:32,NEGATIVE_256:255,POSITIVE_256:128},eC={INVALID_ENCODING_NAME:"Invalid name. Invalid name. Please check 'name' is a directory type.",INVALID_ENCODING_NAME_LEN:"Invalid name. Please check 'name' length is less than 255 byte.",INVALID_ENCODING_LINKNAME:"Invalid linkname. Please check 'linkname' length is less than 100 byte."},ew=new TextEncoder,eO=ew.encode.bind(ew);function eS(e,t){let n=e.toString(8);return t?n.length<=t?"0".repeat(t-n.length)+n+" ":"7".repeat(t)+" ":n}function ek(e,t){let n=" "+e+"="+t+"\n",r=eO(n);return r.length+String(r.length).length+n}function eI(e){let t=new Uint8Array(512),n=e.name;e.typeflag===ev.DIR_TYPE&&"/"!==n[n.length-1]&&(n+="/");let r="",i=!1;for(;n.length>100;){let e=n.indexOf("/");if(-1===e){i=!0;break}{let t=n.slice(0,e);r+=r?"/"+t:t,n=n.slice(e+1)}}if(i)throw Error(eC.INVALID_ENCODING_NAME);let o=eO(n);if(o.length+r.length>255)throw Error(eC.INVALID_ENCODING_NAME_LEN);if(e.linkname&&eO(e.linkname).length>100)throw Error(eC.INVALID_ENCODING_LINKNAME);if(t.set(o,0),t.set(eO(eS(e.mode,6)),100),t.set(eO(eS(e.uid,6)),108),t.set(eO(eS(e.gid,6)),116),e.size.toString(8).length>11){let n=e.size,r=[e$.POSITIVE_256];for(let e=11;e>0;e--)r[e]=n&e$.NEGATIVE_256,n=Math.floor(n/256);t.set(r,124)}else t.set(eO(eS(e.size,11)),124);return t.set(eO(eS(e.mtime,11)),136),t.set(eO(e.typeflag),156),e.linkname&&t.set(eO(e.linkname),157),t.set(eO(e$.T_MAGIC),257),t.set(eO(e$.T_VERSION),263),e.uname&&t.set(eO(e.uname),265),e.gname&&t.set(eO(e.gname),297),t.set(eO(eS(e.devmajor,6)),329),t.set(eO(eS(e.devminor,6)),337),r&&t.set(eO(r),345),t.set(eO(eS(t.subarray(0,512).reduce((e,t,n)=>n>=148&&n<156?e+e$.WHITE_SPACE:e+t,0),6)),148),t}function eT(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let eN={HAS_DONE:"Can't add new entry after calling done()"},eH={mode:420,uid:0,gid:0,typeflag:ev.REG_TYPE,devmajor:0,devminor:0};class eL{resolveHeadOptions(e,t){let{filename:n,...r}=t;return{...eH,...r,name:n,mtime:Math.floor(Date.now()/1e3),size:e}}add(e,t){if(this.finished)throw Error(eN.HAS_DONE);let n=this.resolveHeadOptions(e.length,t);this.transport(e,n)}done(){this.finished||(this.finished=!0,this.reader.push(new Uint8Array(1024)),this.reader.push(null))}fix(e){let t=(512-e%512)%512;t>0&&this.reader.push(new Uint8Array(t))}transport(e,t){let n=e=>{if(t.pax){let e=function(e){let t="";if(t+=ek("path",e.name)+ek("linkpath",e.linkname),e.pax&&"object"==typeof e.pax)for(let n in e.pax)t+=ek(n,e.pax[n]);return eO(t)}({name:t.name,linkname:t.linkname||"",pax:{...t.pax}}),n=eI({...t,name:"pax_header",typeflag:ev.XHD_TYPE,size:e.length});this.reader.push(n),this.reader.push(e),this.reader.push(this.fix(e.length)),t.name="pax_header"}this.reader.push(eI(t)),this.reader.push(e)},r=new y.Writable({write:(e,t,r)=>{try{n(e),r()}catch(e){r(e)}},final:e=>{this.reader.push(this.fix(t.size)),e()}});r.write(e,e=>{e&&this.reader.emit("error",e)}),r.end()}get receiver(){return this.reader}constructor(){eT(this,"reader",void 0),eT(this,"finished",void 0),this.reader=new y.Readable({read(){}}),this.finished=!1}}function eP(e){return e.length}function eM(e,t,n){let r="function"==typeof t?t(e,n):t,{dir:i,base:o}=f.parse(e);return r.replace(/\[path\]/,i?i+"/":"").replace(/\[base\]/,o)}function eD(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}async function eB(e){let t=await Promise.all((await d.readdir(e)).map(t=>f.join(e,t))),n=0,r=[];for(;n!==eP(t);){let e=t[n],i=await d.stat(e);if(i.isDirectory()){let n=await d.readdir(e);t.push(...n.map(t=>f.join(e,t)))}i.isFile()&&r.push(e),n++}return r}const eG=new TextEncoder;function eU(e){return"string"==typeof e?eG.encode(e):e}function ej(){}async function eF(e,t,n){try{return await t(e,n)}catch(e){return Promise.reject(e)}}const eq={gzip:{level:m.constants.Z_BEST_COMPRESSION},brotliCompress:{params:{[m.constants.BROTLI_PARAM_QUALITY]:m.constants.BROTLI_MAX_QUALITY}},deflate:{level:m.constants.Z_BEST_COMPRESSION},deflateRaw:{level:m.constants.Z_BEST_COMPRESSION}};function eK(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class eW{enqueue(e){this.queue.push(e),this.run()}async run(){for(;this.running<this.maxConcurrent&&this.queue.length;){let e=this.queue.shift();this.running++;try{await e()}catch(e){this.errors.push(e)}finally{this.running--,this.run()}}}async wait(){for(;this.running;)await new Promise(e=>setTimeout(e,0));if(eP(this.errors))throw AggregateError(this.errors,"task failed")}constructor(e){eK(this,"maxConcurrent",void 0),eK(this,"queue",void 0),eK(this,"running",void 0),eK(this,"errors",void 0),this.maxConcurrent=e,this.queue=[],this.errors=[],this.running=0}}const ez="vite-plugin-compression",eV=(()=>{let e=g.cpus()||{length:1};return 1===e.length?10:Math.max(1,e.length-1)})();function eX(e){var t;let n=new Set,r=(e,t)=>eD(f.resolve(e,t));return(null==(t=e.build.rollupOptions)?void 0:t.output)?(Array.isArray(e.build.rollupOptions.output)?e.build.rollupOptions.output:[e.build.rollupOptions.output]).forEach(t=>{("object"!=typeof t||eP(Object.keys(t)))&&n.add(r(e.root,t.dir||e.build.outDir))}):n.add(r(e.root,e.build.outDir)),n}async function eQ(e,t){let n=!("copyPublicDir"in e.build)||e.build.copyPublicDir;if(e.publicDir&&n&&h.existsSync(e.publicDir)){let n=await eB(e.publicDir),r=f.join(e.root,f.relative(e.root,e.publicDir));n.forEach(e=>{t(eD(f.relative(r,e)),e)})}}function eY(e={}){let t,{include:n=/\.(html|xml|css|json|js|mjs|svg|yaml|yml|toml)$/,exclude:r,threshold:i=0,algorithms:o=["gzip","brotliCompress"],filename:a,deleteOriginalAssets:s=!1,skipIfLargerOrEqual:u=!0}=e,l=[];o.forEach(e=>{"string"==typeof e?l.push(eZ(e)):"object"==typeof e&&Array.isArray(e)&&l.push(e)});let p=w(n,r),c=[],h=[],{msgs:g,cleanup:y}=function(){let e=[],t=process.stdout.write.bind(process.stdout);return process.stdout.write=function(...n){let[r]=n,i="string"==typeof r?r:r.toString();return i.includes("built in")?(e.push(i),!1):t.apply(this,n)},{cleanup:()=>process.stdout.write=t,msgs:e}}(),E=process.cwd(),A=l.map(([e,t])=>({algorithm:"string"==typeof e?function(e){let t=e in m?e:"gzip";return{algorithm:b.promisify(m[t])}}(e).algorithm:e,options:t,filename:null!=a?a:"brotliCompress"===e?"[path][base].br":"[path][base].gz"})),R=new eW(eV),x=async function(e,t){for(let e in t){if(!p(e))continue;let n=t[e],r=eU("asset"===n.type?n.source:n.code),o=eP(r);o<i||R.enqueue(async()=>{for(let n=0;n<A.length;n++){let i=A[n],a=n===A.length-1,l=eM(e,i.filename,{options:i.options,algorithm:i.algorithm}),p=await eF(r,i.algorithm,i.options);if(u&&eP(p)>=o)return;a&&(s||e===l)&&Reflect.deleteProperty(t,e),this.emitFile({type:"asset",fileName:l,source:p})}})}await R.wait().catch(this.error)},_={resolve:ej},v={staticOutputs:new Set,done:new Promise(e=>{_.resolve=e})},$=new Intl.NumberFormat("en",{maximumFractionDigits:2,minimumFractionDigits:2}),C=e=>`${$.format(e/1e3)} kB`;return{name:ez,apply:"build",enforce:"post",api:v,async configResolved(e){h.push(...eX(e)),await eQ(e,e=>{c.push(e)});let n=e.plugins.find(e=>"vite:build-import-analysis"===e.name);if(!n)throw Error("[vite-plugin-compression] Can't be work in versions lower than vite at 2.0.0");let r=n.generateBundle;if("object"==typeof r&&r.handler){let e=r.handler;r.handler=async function(...t){await e.apply(this,t),await x.apply(this,t)}}"function"==typeof r&&(n.generateBundle=async function(...e){await r.apply(this,e),await x.apply(this,e)}),t=e.logger,E=e.root},async closeBundle(){let e=[],n=async(t,n,r)=>{let i=await d.readFile(t);for(let o=0;o<A.length;o++){let a=A[o],l=o===A.length-1,p=await eF(i,a.algorithm,a.options);if(u&&eP(p)>=eP(i)){v.staticOutputs.has(n)||v.staticOutputs.add(n);return}let c=eM(n,a.filename,{options:a.options,algorithm:a.algorithm});v.staticOutputs.has(c)||v.staticOutputs.add(c);let h=f.join(r,c);l&&s&&h!==t&&await d.rm(t,{recursive:!0,force:!0}),await d.writeFile(h,p),e.push({dest:f.relative(E,r)+"/",file:c,size:eP(p)})}},r=async(e,t)=>{let r=f.join(e,t);if(!p(r)&&!v.staticOutputs.has(t))return void v.staticOutputs.add(t);let{size:o}=await d.stat(r);if(o<i){v.staticOutputs.has(t)||v.staticOutputs.add(t);return}await n(r,t,e)};for(let e of h)for(let t of c)R.enqueue(()=>r(e,t));if(await R.wait().catch(e=>e),_.resolve(),y(),t){let n=e.reduce((e,t)=>Math.max(e,(t.dest+t.file).length),0);for(let{dest:r,file:i,size:o}of e){let e=i.padEnd(n);t.info(S.dim(r)+S.green(e)+S.bold(S.dim(C(o))))}}for(let e of g)console.info(e)}}}function eZ(e,t){if("string"==typeof e){if(e in eq){let n={...eq[e]};return t&&Object.assign(n,t),[e,n]}throw Error(`[vite-plugin-compression] Unsupported algorithm: ${e}`)}return[e,t||{}]}eY.getPluginAPI=e=>{var t;return null==(t=e.find(e=>e.name===ez))?void 0:t.api},exports.compression=eY,exports.default=eY,exports.defineAlgorithm=eZ,exports.tarball=function(e={}){let t,{dest:n}=e,r=[],i=[],o=[],a=process.cwd(),s=function(){let e=new eL,t=[],n={dests:[],root:""};return{add:t=>{e.add(eU(t.content),{filename:t.filename})},setup:e=>{Object.assign(n,e),n.dests.forEach(e=>{let r=eD(f.resolve(n.root,e+".tar")),i=eD(f.dirname(r));eD(n.root)!==i&&h.mkdirSync(i,{recursive:!0});let o=h.createWriteStream(r);t.push(o)})},done:async()=>{e.done(),await Promise.all(t.map(t=>new Promise((n,r)=>{t.on("error",r),t.on("finish",n),e.receiver.pipe(t)}))),t.length=0}}}(),u=new eW(eV);return{name:"vite-plugin-tarball",enforce:"post",async configResolved(e){i.push(...eX(e)),a=e.root,o=n?[n]:i,(t=eY.getPluginAPI(e.plugins))||await eQ(e,e=>{r.push(e)}),s.setup({dests:o,root:a})},writeBundle(e,t){for(let e in t){let n=t[e];s.add({filename:e,content:"asset"===n.type?n.source:n.code})}},async closeBundle(){for(let e of(t&&await t.done,!r.length&&t&&t.staticOutputs.size&&r.push(...t.staticOutputs),i))for(let t of r)u.enqueue(async()=>{let n=f.join(e,t),r=await d.readFile(n);s.add({filename:t,content:r})});await u.wait(),await s.done()}}};

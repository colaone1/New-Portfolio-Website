import e,{win32 as t,posix as n,isAbsolute as r,resolve as o}from"path";import i from"fs";import a from"node:fs/promises";import s from"os";import{Writable as u,Readable as l}from"stream";import p from"util";import c from"zlib";import f from"node:url";import h from"node:path";import d from"node:module";let g=f.fileURLToPath(import.meta.url);function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}h.dirname(g),d.createRequire(import.meta.url);var m,b,E,A,R,_,x,v,$,C,w,O,S={};function k(){if(b)return m;b=1;let t="[^\\\\/]",n="[^/]",r="(?:\\/|$)",o="(?:^|\\/)",i=`\\.{1,2}${r}`,a=`(?!${o}${i})`,s=`(?!\\.{0,1}${r})`,u=`(?!${i})`,l=`${n}*?`,p={DOT_LITERAL:"\\.",PLUS_LITERAL:"\\+",QMARK_LITERAL:"\\?",SLASH_LITERAL:"\\/",ONE_CHAR:"(?=.)",QMARK:n,END_ANCHOR:r,DOTS_SLASH:i,NO_DOT:"(?!\\.)",NO_DOTS:a,NO_DOT_SLASH:s,NO_DOTS_SLASH:u,QMARK_NO_DOT:"[^.\\/]",STAR:l,START_ANCHOR:o},c={...p,SLASH_LITERAL:"[\\\\/]",QMARK:t,STAR:`${t}*?`,DOTS_SLASH:"\\.{1,2}(?:[\\\\/]|$)",NO_DOT:"(?!\\.)",NO_DOTS:"(?!(?:^|[\\\\/])\\.{1,2}(?:[\\\\/]|$))",NO_DOT_SLASH:"(?!\\.{0,1}(?:[\\\\/]|$))",NO_DOTS_SLASH:"(?!\\.{1,2}(?:[\\\\/]|$))",QMARK_NO_DOT:"[^.\\\\/]",START_ANCHOR:"(?:^|[\\\\/])",END_ANCHOR:"(?:[\\\\/]|$)"};return m={MAX_LENGTH:65536,POSIX_REGEX_SOURCE:{alnum:"a-zA-Z0-9",alpha:"a-zA-Z",ascii:"\\x00-\\x7F",blank:" \\t",cntrl:"\\x00-\\x1F\\x7F",digit:"0-9",graph:"\\x21-\\x7E",lower:"a-z",print:"\\x20-\\x7E ",punct:"\\-!\"#$%&'()\\*+,./:;<=>?@[\\]^_`{|}~",space:" \\t\\r\\n\\v\\f",upper:"A-Z",word:"A-Za-z0-9_",xdigit:"A-Fa-f0-9"},REGEX_BACKSLASH:/\\(?![*+?^${}(|)[\]])/g,REGEX_NON_SPECIAL_CHARS:/^[^@![\].,$*+?^{}()|\\/]+/,REGEX_SPECIAL_CHARS:/[-*+?.^${}(|)[\]]/,REGEX_SPECIAL_CHARS_BACKREF:/(\\?)((\W)(\3*))/g,REGEX_SPECIAL_CHARS_GLOBAL:/([-*+?.^${}(|)[\]])/g,REGEX_REMOVE_BACKSLASH:/(?:\[.*?[^\\]\]|\\(?=.))/g,REPLACEMENTS:{"***":"*","**/**":"**","**/**/**":"**"},CHAR_0:48,CHAR_9:57,CHAR_UPPERCASE_A:65,CHAR_LOWERCASE_A:97,CHAR_UPPERCASE_Z:90,CHAR_LOWERCASE_Z:122,CHAR_LEFT_PARENTHESES:40,CHAR_RIGHT_PARENTHESES:41,CHAR_ASTERISK:42,CHAR_AMPERSAND:38,CHAR_AT:64,CHAR_BACKWARD_SLASH:92,CHAR_CARRIAGE_RETURN:13,CHAR_CIRCUMFLEX_ACCENT:94,CHAR_COLON:58,CHAR_COMMA:44,CHAR_DOT:46,CHAR_DOUBLE_QUOTE:34,CHAR_EQUAL:61,CHAR_EXCLAMATION_MARK:33,CHAR_FORM_FEED:12,CHAR_FORWARD_SLASH:47,CHAR_GRAVE_ACCENT:96,CHAR_HASH:35,CHAR_HYPHEN_MINUS:45,CHAR_LEFT_ANGLE_BRACKET:60,CHAR_LEFT_CURLY_BRACE:123,CHAR_LEFT_SQUARE_BRACKET:91,CHAR_LINE_FEED:10,CHAR_NO_BREAK_SPACE:160,CHAR_PERCENT:37,CHAR_PLUS:43,CHAR_QUESTION_MARK:63,CHAR_RIGHT_ANGLE_BRACKET:62,CHAR_RIGHT_CURLY_BRACE:125,CHAR_RIGHT_SQUARE_BRACKET:93,CHAR_SEMICOLON:59,CHAR_SINGLE_QUOTE:39,CHAR_SPACE:32,CHAR_TAB:9,CHAR_UNDERSCORE:95,CHAR_VERTICAL_LINE:124,CHAR_ZERO_WIDTH_NOBREAK_SPACE:65279,SEP:e.sep,extglobChars:e=>({"!":{type:"negate",open:"(?:(?!(?:",close:`))${e.STAR})`},"?":{type:"qmark",open:"(?:",close:")?"},"+":{type:"plus",open:"(?:",close:")+"},"*":{type:"star",open:"(?:",close:")*"},"@":{type:"at",open:"(?:",close:")"}}),globChars:e=>!0===e?c:p}}function I(){if(E)return S;E=1;let t="win32"===process.platform,{REGEX_BACKSLASH:n,REGEX_REMOVE_BACKSLASH:r,REGEX_SPECIAL_CHARS:o,REGEX_SPECIAL_CHARS_GLOBAL:i}=k();return S.isObject=e=>null!==e&&"object"==typeof e&&!Array.isArray(e),S.hasRegexChars=e=>o.test(e),S.isRegexChar=e=>1===e.length&&S.hasRegexChars(e),S.escapeRegex=e=>e.replace(i,"\\$1"),S.toPosixSlashes=e=>e.replace(n,"/"),S.removeBackslashes=e=>e.replace(r,e=>"\\"===e?"":e),S.supportsLookbehinds=()=>{let e=process.version.slice(1).split(".").map(Number);return 3===e.length&&!!(e[0]>=9)||8===e[0]&&!!(e[1]>=10)},S.isWindows=n=>n&&"boolean"==typeof n.windows?n.windows:!0===t||"\\"===e.sep,S.escapeLast=(e,t,n)=>{let r=e.lastIndexOf(t,n);return -1===r?e:"\\"===e[r-1]?S.escapeLast(e,t,r-1):`${e.slice(0,r)}\\${e.slice(r)}`},S.removePrefix=(e,t={})=>{let n=e;return n.startsWith("./")&&(n=n.slice(2),t.prefix="./"),n},S.wrapOutput=(e,t={},n={})=>{let r=n.contains?"":"^",o=n.contains?"":"$",i=`${r}(?:${e})${o}`;return!0===t.negated&&(i=`(?:^(?!${i}).*$)`),i},S}var T=y(w?C:(w=1,C=function(){if($)return v;$=1;let t=function(){if(R)return A;R=1;let e=I(),{CHAR_ASTERISK:t,CHAR_AT:n,CHAR_BACKWARD_SLASH:r,CHAR_COMMA:o,CHAR_DOT:i,CHAR_EXCLAMATION_MARK:a,CHAR_FORWARD_SLASH:s,CHAR_LEFT_CURLY_BRACE:u,CHAR_LEFT_PARENTHESES:l,CHAR_LEFT_SQUARE_BRACKET:p,CHAR_PLUS:c,CHAR_QUESTION_MARK:f,CHAR_RIGHT_CURLY_BRACE:h,CHAR_RIGHT_PARENTHESES:d,CHAR_RIGHT_SQUARE_BRACKET:g}=k(),y=e=>e===s||e===r,m=e=>{!0!==e.isPrefix&&(e.depth=e.isGlobstar?1/0:1)};return A=(b,E)=>{let A,R,_=E||{},x=b.length-1,v=!0===_.parts||!0===_.scanToEnd,$=[],C=[],w=[],O=b,S=-1,k=0,I=0,T=!1,N=!1,H=!1,L=!1,P=!1,M=!1,D=!1,B=!1,G=!1,U=!1,j=0,F={value:"",depth:0,isGlob:!1},q=()=>S>=x,K=()=>O.charCodeAt(S+1),W=()=>(A=R,O.charCodeAt(++S));for(;S<x;){let e;if((R=W())===r){D=F.backslashes=!0,(R=W())===u&&(M=!0);continue}if(!0===M||R===u){for(j++;!0!==q()&&(R=W());){if(R===r){D=F.backslashes=!0,W();continue}if(R===u){j++;continue}if(!0!==M&&R===i&&(R=W())===i||!0!==M&&R===o){if(T=F.isBrace=!0,H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===h&&0==--j){M=!1,T=F.isBrace=!0,U=!0;break}}if(!0===v)continue;break}if(R===s){if($.push(S),C.push(F),F={value:"",depth:0,isGlob:!1},!0===U)continue;if(A===i&&S===k+1){k+=2;continue}I=S+1;continue}if(!0!==_.noext&&!0==(R===c||R===n||R===t||R===f||R===a)&&K()===l){if(H=F.isGlob=!0,L=F.isExtglob=!0,U=!0,R===a&&S===k&&(G=!0),!0===v){for(;!0!==q()&&(R=W());){if(R===r){D=F.backslashes=!0,R=W();continue}if(R===d){H=F.isGlob=!0,U=!0;break}}continue}break}if(R===t){if(A===t&&(P=F.isGlobstar=!0),H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===f){if(H=F.isGlob=!0,U=!0,!0===v)continue;break}if(R===p){for(;!0!==q()&&(e=W());){if(e===r){D=F.backslashes=!0,W();continue}if(e===g){N=F.isBracket=!0,H=F.isGlob=!0,U=!0;break}}if(!0===v)continue;break}if(!0!==_.nonegate&&R===a&&S===k){B=F.negated=!0,k++;continue}if(!0!==_.noparen&&R===l){if(H=F.isGlob=!0,!0===v){for(;!0!==q()&&(R=W());){if(R===l){D=F.backslashes=!0,R=W();continue}if(R===d){U=!0;break}}continue}break}if(!0===H){if(U=!0,!0===v)continue;break}}!0===_.noext&&(L=!1,H=!1);let z=O,V="",X="";k>0&&(V=O.slice(0,k),O=O.slice(k),I-=k),z&&!0===H&&I>0?(z=O.slice(0,I),X=O.slice(I)):!0===H?(z="",X=O):z=O,z&&""!==z&&"/"!==z&&z!==O&&y(z.charCodeAt(z.length-1))&&(z=z.slice(0,-1)),!0===_.unescape&&(X&&(X=e.removeBackslashes(X)),z&&!0===D&&(z=e.removeBackslashes(z)));let Q={prefix:V,input:b,start:k,base:z,glob:X,isBrace:T,isBracket:N,isGlob:H,isExtglob:L,isGlobstar:P,negated:B,negatedExtglob:G};if(!0===_.tokens&&(Q.maxDepth=0,y(R)||C.push(F),Q.tokens=C),!0===_.parts||!0===_.tokens){let e;for(let t=0;t<$.length;t++){let n=e?e+1:k,r=$[t],o=b.slice(n,r);_.tokens&&(0===t&&0!==k?(C[t].isPrefix=!0,C[t].value=V):C[t].value=o,m(C[t]),Q.maxDepth+=C[t].depth),(0!==t||""!==o)&&w.push(o),e=r}if(e&&e+1<b.length){let t=b.slice(e+1);w.push(t),_.tokens&&(C[C.length-1].value=t,m(C[C.length-1]),Q.maxDepth+=C[C.length-1].depth)}Q.slashes=$,Q.parts=w}return Q}}(),n=function(){if(x)return _;x=1;let e=k(),t=I(),{MAX_LENGTH:n,POSIX_REGEX_SOURCE:r,REGEX_NON_SPECIAL_CHARS:o,REGEX_SPECIAL_CHARS_BACKREF:i,REPLACEMENTS:a}=e,s=(e,n)=>{if("function"==typeof n.expandRange)return n.expandRange(...e,n);e.sort();let r=`[${e.join("-")}]`;try{new RegExp(r)}catch(n){return e.map(e=>t.escapeRegex(e)).join("..")}return r},u=(e,t)=>`Missing ${e}: "${t}" - use "\\\\${t}" to match literal characters`,l=(p,c)=>{let f;if("string"!=typeof p)throw TypeError("Expected a string");p=a[p]||p;let h={...c},d="number"==typeof h.maxLength?Math.min(n,h.maxLength):n,g=p.length;if(g>d)throw SyntaxError(`Input length: ${g}, exceeds maximum allowed length: ${d}`);let y={type:"bos",value:"",output:h.prepend||""},m=[y],b=h.capture?"":"?:",E=t.isWindows(c),A=e.globChars(E),R=e.extglobChars(A),{DOT_LITERAL:_,PLUS_LITERAL:x,SLASH_LITERAL:v,ONE_CHAR:$,DOTS_SLASH:C,NO_DOT:w,NO_DOT_SLASH:O,NO_DOTS_SLASH:S,QMARK:k,QMARK_NO_DOT:I,STAR:T,START_ANCHOR:N}=A,H=e=>`(${b}(?:(?!${N}${e.dot?C:_}).)*?)`,L=h.dot?"":w,P=h.dot?k:I,M=!0===h.bash?H(h):T;h.capture&&(M=`(${M})`),"boolean"==typeof h.noext&&(h.noextglob=h.noext);let D={input:p,index:-1,start:0,dot:!0===h.dot,consumed:"",output:"",prefix:"",backtrack:!1,negated:!1,brackets:0,braces:0,parens:0,quotes:0,globstar:!1,tokens:m};g=(p=t.removePrefix(p,D)).length;let B=[],G=[],U=[],j=y,F=()=>D.index===g-1,q=D.peek=(e=1)=>p[D.index+e],K=D.advance=()=>p[++D.index]||"",W=()=>p.slice(D.index+1),z=(e="",t=0)=>{D.consumed+=e,D.index+=t},V=e=>{D.output+=null!=e.output?e.output:e.value,z(e.value)},X=()=>{let e=1;for(;"!"===q()&&("("!==q(2)||"?"===q(3));)K(),D.start++,e++;return e%2!=0&&(D.negated=!0,D.start++,!0)},Q=e=>{D[e]++,U.push(e)},Y=e=>{D[e]--,U.pop()},Z=e=>{if("globstar"===j.type){let t=D.braces>0&&("comma"===e.type||"brace"===e.type),n=!0===e.extglob||B.length&&("pipe"===e.type||"paren"===e.type);"slash"===e.type||"paren"===e.type||t||n||(D.output=D.output.slice(0,-j.output.length),j.type="star",j.value="*",j.output=M,D.output+=j.output)}if(B.length&&"paren"!==e.type&&(B[B.length-1].inner+=e.value),(e.value||e.output)&&V(e),j&&"text"===j.type&&"text"===e.type){j.value+=e.value,j.output=(j.output||"")+e.value;return}e.prev=j,m.push(e),j=e},J=(e,t)=>{let n={...R[t],conditions:1,inner:""};n.prev=j,n.parens=D.parens,n.output=D.output;let r=(h.capture?"(":"")+n.open;Q("parens"),Z({type:e,value:t,output:D.output?"":$}),Z({type:"paren",extglob:!0,value:K(),output:r}),B.push(n)},ee=e=>{let t,n=e.close+(h.capture?")":"");if("negate"===e.type){let r=M;if(e.inner&&e.inner.length>1&&e.inner.includes("/")&&(r=H(h)),(r!==M||F()||/^\)+$/.test(W()))&&(n=e.close=`)$))${r}`),e.inner.includes("*")&&(t=W())&&/^\.[^\\/.]+$/.test(t)){let o=l(t,{...c,fastpaths:!1}).output;n=e.close=`)${o})${r})`}"bos"===e.prev.type&&(D.negatedExtglob=!0)}Z({type:"paren",extglob:!0,value:f,output:n}),Y("parens")};if(!1!==h.fastpaths&&!/(^[*!]|[/()[\]{}"])/.test(p)){let e=!1,n=p.replace(i,(t,n,r,o,i,a)=>"\\"===o?(e=!0,t):"?"===o?n?n+o+(i?k.repeat(i.length):""):0===a?P+(i?k.repeat(i.length):""):k.repeat(r.length):"."===o?_.repeat(r.length):"*"===o?n?n+o+(i?M:""):M:n?t:`\\${t}`);return(!0===e&&(n=!0===h.unescape?n.replace(/\\/g,""):n.replace(/\\+/g,e=>e.length%2==0?"\\\\":e?"\\":"")),n===p&&!0===h.contains)?D.output=p:D.output=t.wrapOutput(n,D,c),D}for(;!F();){if("\0"===(f=K()))continue;if("\\"===f){let e=q();if("/"===e&&!0!==h.bash||"."===e||";"===e)continue;if(!e){Z({type:"text",value:f+="\\"});continue}let t=/^\\+/.exec(W()),n=0;if(t&&t[0].length>2&&(n=t[0].length,D.index+=n,n%2!=0&&(f+="\\")),!0===h.unescape?f=K():f+=K(),0===D.brackets){Z({type:"text",value:f});continue}}if(D.brackets>0&&("]"!==f||"["===j.value||"[^"===j.value)){if(!1!==h.posix&&":"===f){let e=j.value.slice(1);if(e.includes("[")&&(j.posix=!0,e.includes(":"))){let e=j.value.lastIndexOf("["),t=j.value.slice(0,e),n=r[j.value.slice(e+2)];if(n){j.value=t+n,D.backtrack=!0,K(),y.output||1!==m.indexOf(j)||(y.output=$);continue}}}("["===f&&":"!==q()||"-"===f&&"]"===q())&&(f=`\\${f}`),"]"===f&&("["===j.value||"[^"===j.value)&&(f=`\\${f}`),!0===h.posix&&"!"===f&&"["===j.value&&(f="^"),j.value+=f,V({value:f});continue}if(1===D.quotes&&'"'!==f){f=t.escapeRegex(f),j.value+=f,V({value:f});continue}if('"'===f){D.quotes=+(1!==D.quotes),!0===h.keepQuotes&&Z({type:"text",value:f});continue}if("("===f){Q("parens"),Z({type:"paren",value:f});continue}if(")"===f){if(0===D.parens&&!0===h.strictBrackets)throw SyntaxError(u("opening","("));let e=B[B.length-1];if(e&&D.parens===e.parens+1){ee(B.pop());continue}Z({type:"paren",value:f,output:D.parens?")":"\\)"}),Y("parens");continue}if("["===f){if(!0!==h.nobracket&&W().includes("]"))Q("brackets");else{if(!0!==h.nobracket&&!0===h.strictBrackets)throw SyntaxError(u("closing","]"));f=`\\${f}`}Z({type:"bracket",value:f});continue}if("]"===f){if(!0===h.nobracket||j&&"bracket"===j.type&&1===j.value.length){Z({type:"text",value:f,output:`\\${f}`});continue}if(0===D.brackets){if(!0===h.strictBrackets)throw SyntaxError(u("opening","["));Z({type:"text",value:f,output:`\\${f}`});continue}Y("brackets");let e=j.value.slice(1);if(!0===j.posix||"^"!==e[0]||e.includes("/")||(f=`/${f}`),j.value+=f,V({value:f}),!1===h.literalBrackets||t.hasRegexChars(e))continue;let n=t.escapeRegex(j.value);if(D.output=D.output.slice(0,-j.value.length),!0===h.literalBrackets){D.output+=n,j.value=n;continue}j.value=`(${b}${n}|${j.value})`,D.output+=j.value;continue}if("{"===f&&!0!==h.nobrace){Q("braces");let e={type:"brace",value:f,output:"(",outputIndex:D.output.length,tokensIndex:D.tokens.length};G.push(e),Z(e);continue}if("}"===f){let e=G[G.length-1];if(!0===h.nobrace||!e){Z({type:"text",value:f,output:f});continue}let t=")";if(!0===e.dots){let e=m.slice(),n=[];for(let t=e.length-1;t>=0&&(m.pop(),"brace"!==e[t].type);t--)"dots"!==e[t].type&&n.unshift(e[t].value);t=s(n,h),D.backtrack=!0}if(!0!==e.comma&&!0!==e.dots){let n=D.output.slice(0,e.outputIndex),r=D.tokens.slice(e.tokensIndex);for(let o of(e.value=e.output="\\{",f=t="\\}",D.output=n,r))D.output+=o.output||o.value}Z({type:"brace",value:f,output:t}),Y("braces"),G.pop();continue}if("|"===f){B.length>0&&B[B.length-1].conditions++,Z({type:"text",value:f});continue}if(","===f){let e=f,t=G[G.length-1];t&&"braces"===U[U.length-1]&&(t.comma=!0,e="|"),Z({type:"comma",value:f,output:e});continue}if("/"===f){if("dot"===j.type&&D.index===D.start+1){D.start=D.index+1,D.consumed="",D.output="",m.pop(),j=y;continue}Z({type:"slash",value:f,output:v});continue}if("."===f){if(D.braces>0&&"dot"===j.type){"."===j.value&&(j.output=_);let e=G[G.length-1];j.type="dots",j.output+=f,j.value+=f,e.dots=!0;continue}if(D.braces+D.parens===0&&"bos"!==j.type&&"slash"!==j.type){Z({type:"text",value:f,output:_});continue}Z({type:"dot",value:f,output:_});continue}if("?"===f){if(!(j&&"("===j.value)&&!0!==h.noextglob&&"("===q()&&"?"!==q(2)){J("qmark",f);continue}if(j&&"paren"===j.type){let e=q(),n=f;if("<"===e&&!t.supportsLookbehinds())throw Error("Node.js v10 or higher is required for regex lookbehinds");("("!==j.value||/[!=<:]/.test(e))&&("<"!==e||/<([!=]|\w+>)/.test(W()))||(n=`\\${f}`),Z({type:"text",value:f,output:n});continue}if(!0!==h.dot&&("slash"===j.type||"bos"===j.type)){Z({type:"qmark",value:f,output:I});continue}Z({type:"qmark",value:f,output:k});continue}if("!"===f){if(!0!==h.noextglob&&"("===q()&&("?"!==q(2)||!/[!=<:]/.test(q(3)))){J("negate",f);continue}if(!0!==h.nonegate&&0===D.index){X();continue}}if("+"===f){if(!0!==h.noextglob&&"("===q()&&"?"!==q(2)){J("plus",f);continue}if(j&&"("===j.value||!1===h.regex){Z({type:"plus",value:f,output:x});continue}if(j&&("bracket"===j.type||"paren"===j.type||"brace"===j.type)||D.parens>0){Z({type:"plus",value:f});continue}Z({type:"plus",value:x});continue}if("@"===f){if(!0!==h.noextglob&&"("===q()&&"?"!==q(2)){Z({type:"at",extglob:!0,value:f,output:""});continue}Z({type:"text",value:f});continue}if("*"!==f){("$"===f||"^"===f)&&(f=`\\${f}`);let e=o.exec(W());e&&(f+=e[0],D.index+=e[0].length),Z({type:"text",value:f});continue}if(j&&("globstar"===j.type||!0===j.star)){j.type="star",j.star=!0,j.value+=f,j.output=M,D.backtrack=!0,D.globstar=!0,z(f);continue}let e=W();if(!0!==h.noextglob&&/^\([^?]/.test(e)){J("star",f);continue}if("star"===j.type){if(!0===h.noglobstar){z(f);continue}let t=j.prev,n=t.prev,r="slash"===t.type||"bos"===t.type,o=n&&("star"===n.type||"globstar"===n.type);if(!0===h.bash&&(!r||e[0]&&"/"!==e[0])){Z({type:"star",value:f,output:""});continue}let i=D.braces>0&&("comma"===t.type||"brace"===t.type),a=B.length&&("pipe"===t.type||"paren"===t.type);if(!r&&"paren"!==t.type&&!i&&!a){Z({type:"star",value:f,output:""});continue}for(;"/**"===e.slice(0,3);){let t=p[D.index+4];if(t&&"/"!==t)break;e=e.slice(3),z("/**",3)}if("bos"===t.type&&F()){j.type="globstar",j.value+=f,j.output=H(h),D.output=j.output,D.globstar=!0,z(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&!o&&F()){D.output=D.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=H(h)+(h.strictSlashes?")":"|$)"),j.value+=f,D.globstar=!0,D.output+=t.output+j.output,z(f);continue}if("slash"===t.type&&"bos"!==t.prev.type&&"/"===e[0]){let n=void 0!==e[1]?"|$":"";D.output=D.output.slice(0,-(t.output+j.output).length),t.output=`(?:${t.output}`,j.type="globstar",j.output=`${H(h)}${v}|${v}${n})`,j.value+=f,D.output+=t.output+j.output,D.globstar=!0,z(f+K()),Z({type:"slash",value:"/",output:""});continue}if("bos"===t.type&&"/"===e[0]){j.type="globstar",j.value+=f,j.output=`(?:^|${v}|${H(h)}${v})`,D.output=j.output,D.globstar=!0,z(f+K()),Z({type:"slash",value:"/",output:""});continue}D.output=D.output.slice(0,-j.output.length),j.type="globstar",j.output=H(h),j.value+=f,D.output+=j.output,D.globstar=!0,z(f);continue}let n={type:"star",value:f,output:M};if(!0===h.bash){n.output=".*?",("bos"===j.type||"slash"===j.type)&&(n.output=L+n.output),Z(n);continue}if(j&&("bracket"===j.type||"paren"===j.type)&&!0===h.regex){n.output=f,Z(n);continue}(D.index===D.start||"slash"===j.type||"dot"===j.type)&&("dot"===j.type?(D.output+=O,j.output+=O):!0===h.dot?(D.output+=S,j.output+=S):(D.output+=L,j.output+=L),"*"!==q()&&(D.output+=$,j.output+=$)),Z(n)}for(;D.brackets>0;){if(!0===h.strictBrackets)throw SyntaxError(u("closing","]"));D.output=t.escapeLast(D.output,"["),Y("brackets")}for(;D.parens>0;){if(!0===h.strictBrackets)throw SyntaxError(u("closing",")"));D.output=t.escapeLast(D.output,"("),Y("parens")}for(;D.braces>0;){if(!0===h.strictBrackets)throw SyntaxError(u("closing","}"));D.output=t.escapeLast(D.output,"{"),Y("braces")}if(!0!==h.strictSlashes&&("star"===j.type||"bracket"===j.type)&&Z({type:"maybe_slash",value:"",output:`${v}?`}),!0===D.backtrack)for(let e of(D.output="",D.tokens))D.output+=null!=e.output?e.output:e.value,e.suffix&&(D.output+=e.suffix);return D};return l.fastpaths=(r,o)=>{let i={...o},s="number"==typeof i.maxLength?Math.min(n,i.maxLength):n,u=r.length;if(u>s)throw SyntaxError(`Input length: ${u}, exceeds maximum allowed length: ${s}`);r=a[r]||r;let l=t.isWindows(o),{DOT_LITERAL:p,SLASH_LITERAL:c,ONE_CHAR:f,DOTS_SLASH:h,NO_DOT:d,NO_DOTS:g,NO_DOTS_SLASH:y,STAR:m,START_ANCHOR:b}=e.globChars(l),E=i.dot?g:d,A=i.dot?y:d,R=i.capture?"":"?:",_=!0===i.bash?".*?":m;i.capture&&(_=`(${_})`);let x=e=>!0===e.noglobstar?_:`(${R}(?:(?!${b}${e.dot?h:p}).)*?)`,v=e=>{switch(e){case"*":return`${E}${f}${_}`;case".*":return`${p}${f}${_}`;case"*.*":return`${E}${_}${p}${f}${_}`;case"*/*":return`${E}${_}${c}${f}${A}${_}`;case"**":return E+x(i);case"**/*":return`(?:${E}${x(i)}${c})?${A}${f}${_}`;case"**/*.*":return`(?:${E}${x(i)}${c})?${A}${_}${p}${f}${_}`;case"**/.*":return`(?:${E}${x(i)}${c})?${p}${f}${_}`;default:{let t=/^(.*?)\.(\w+)$/.exec(e);if(!t)return;let n=v(t[1]);if(!n)return;return n+p+t[2]}}},$=v(t.removePrefix(r,{negated:!1,prefix:""}));return $&&!0!==i.strictSlashes&&($+=`${c}?`),$},_=l}(),r=I(),o=k(),i=e=>e&&"object"==typeof e&&!Array.isArray(e),a=(e,t,n=!1)=>{if(Array.isArray(e)){let r=e.map(e=>a(e,t,n));return e=>{for(let t of r){let n=t(e);if(n)return n}return!1}}let o=i(e)&&e.tokens&&e.input;if(""===e||"string"!=typeof e&&!o)throw TypeError("Expected pattern to be a non-empty string");let s=t||{},u=r.isWindows(t),l=o?a.compileRe(e,t):a.makeRe(e,t,!1,!0),p=l.state;delete l.state;let c=()=>!1;if(s.ignore){let e={...t,ignore:null,onMatch:null,onResult:null};c=a(s.ignore,e,n)}let f=(n,r=!1)=>{let{isMatch:o,match:i,output:f}=a.test(n,l,t,{glob:e,posix:u}),h={glob:e,state:p,regex:l,posix:u,input:n,output:f,match:i,isMatch:o};return("function"==typeof s.onResult&&s.onResult(h),!1===o)?(h.isMatch=!1,!!r&&h):c(n)?("function"==typeof s.onIgnore&&s.onIgnore(h),h.isMatch=!1,!!r&&h):("function"==typeof s.onMatch&&s.onMatch(h),!r||h)};return n&&(f.state=p),f};return a.test=(e,t,n,{glob:o,posix:i}={})=>{if("string"!=typeof e)throw TypeError("Expected input to be a string");if(""===e)return{isMatch:!1,output:""};let s=n||{},u=s.format||(i?r.toPosixSlashes:null),l=e===o,p=l&&u?u(e):e;return!1===l&&(l=(p=u?u(e):e)===o),(!1===l||!0===s.capture)&&(l=!0===s.matchBase||!0===s.basename?a.matchBase(e,t,n,i):t.exec(p)),{isMatch:!!l,match:l,output:p}},a.matchBase=(t,n,o,i=r.isWindows(o))=>(n instanceof RegExp?n:a.makeRe(n,o)).test(e.basename(t)),a.isMatch=(e,t,n)=>a(t,n)(e),a.parse=(e,t)=>Array.isArray(e)?e.map(e=>a.parse(e,t)):n(e,{...t,fastpaths:!1}),a.scan=(e,n)=>t(e,n),a.compileRe=(e,t,n=!1,r=!1)=>{if(!0===n)return e.output;let o=t||{},i=o.contains?"":"^",s=o.contains?"":"$",u=`${i}(?:${e.output})${s}`;e&&!0===e.negated&&(u=`^(?!${u}).*$`);let l=a.toRegex(u,t);return!0===r&&(l.state=e),l},a.makeRe=(e,t={},r=!1,o=!1)=>{if(!e||"string"!=typeof e)throw TypeError("Expected a non-empty string");let i={negated:!1,fastpaths:!0};return!1!==t.fastpaths&&("."===e[0]||"*"===e[0])&&(i.output=n.fastpaths(e,t)),i.output||(i=n(e,t)),a.compileRe(i,t,r,o)},a.toRegex=(e,t)=>{try{let n=t||{};return new RegExp(e,n.flags||(n.nocase?"i":""))}catch(e){if(t&&!0===t.debug)throw e;return/$^/}},a.constants=o,v=a}()));function N(e){return Array.isArray(e)?e:null==e?[]:[e]}let H=RegExp(`\\${t.sep}`,"g"),L=function(e){return e.replace(H,n.sep)},P=function(e,t,i){let a=i&&i.resolve,s=e=>e instanceof RegExp?e:{test:t=>T(function(e,t){if(!1===t||r(e)||e.startsWith("**"))return L(e);let i=L(o(t||"")).replace(/[-^$*+?.()|[\]{}]/g,"\\$&");return n.join(i,L(e))}(e,a),{dot:!0})(t)},u=N(e).map(s),l=N(t).map(s);return u.length||l.length?function(e){if("string"!=typeof e||e.includes("\0"))return!1;let t=L(e);for(let e=0;e<l.length;++e)if(l[e].test(t))return!1;for(let e=0;e<u.length;++e)if(u[e].test(t))return!0;return!u.length}:e=>"string"==typeof e&&!e.includes("\0")};new Set("break case class catch const continue debugger default delete do else export extends finally for function if import in instanceof let new return super switch this throw try typeof var void while with yield enum await implements package protected static interface private public arguments Infinity NaN undefined null true false eval uneval isFinite isNaN parseFloat parseInt decodeURI decodeURIComponent encodeURI encodeURIComponent escape unescape Object Function Boolean Symbol Error EvalError InternalError RangeError ReferenceError SyntaxError TypeError URIError Number Math Date String RegExp Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array Map Set WeakMap WeakSet SIMD ArrayBuffer DataView JSON Promise Generator GeneratorFunction Reflect Proxy Intl".split(" ")).add("");var M={exports:{}},D=y(function(){if(O)return M.exports;O=1;let e,t,n,{defineProperty:r,setPrototypeOf:o,create:i,keys:a}=Object,{round:s,max:u}=Math,l=e=>{let t=/([a-f\d]{3,6})/i.exec(e)?.[1],n=t?.length,r=parseInt(6^n?3^n?"0":t[0]+t[0]+t[1]+t[1]+t[2]+t[2]:t,16);return[r>>16&255,r>>8&255,255&r]},p=(e,t,n)=>e^t||t^n?16+36*s(e/51)+6*s(t/51)+s(n/51):8>e?16:e>248?231:s(24*(e-8)/247)+232,c=e=>{let t,n,r,o,i;return 8>e?30+e:16>e?e-8+90:(232>e?(i=(e-=16)%36,t=(e/36|0)/5,n=(i/6|0)/5,r=i%6/5):t=n=r=(10*(e-232)+8)/255,(o=2*u(t,n,r))?30+(s(r)<<2|s(n)<<1|s(t))+(2^o?0:60):30)},f=(()=>{let n,r,o,i=e=>l.some(t=>e.test(t)),s=globalThis,u=s.process??{},l=u.argv??[],p=u.env??{},c=-1;try{e=","+a(p).join(",")}catch(e){p={},c=0}let f="FORCE_COLOR",h={false:0,0:0,1:1,2:2,3:3}[p[f]]??-1,d=f in p&&h||i(/^--color=?(true|always)?$/);return d&&(c=h),~c||(n=p,r=!!p.PM2_HOME||p.NEXT_RUNTIME?.includes("edge")||!!u.stdout?.isTTY,o="win32"===u.platform,t=n.TERM,c=({"24bit":3,truecolor:3,ansi256:2,ansi:1})[n.COLORTERM]||(n.CI?/,GITHUB/.test(e)?3:1:r&&"dumb"!==t?o?3:/-256/.test(t)?2:1:0)),!h||p.NO_COLOR||i(/^--(no-color|color=(false|never))$/)?0:s.window?.chrome||d&&!c?3:c})(),h={open:"",close:""},d={},g=({p:e},{open:t,close:r})=>{let i=(e,...n)=>{if(!e){if(t&&t===r)return t;if((e??"")==="")return""}let o,a=e.raw?String.raw({raw:e},...n):""+e,s=i.p,u=s.o,l=s.c;if(a.includes("\x1b"))for(;s;s=s.p){let{open:e,close:t}=s,n=t.length,r="",i=0;if(n)for(;~(o=a.indexOf(t,i));i=o+n)r+=a.slice(i,o)+e;a=r+a.slice(i)}return u+(a.includes("\n")?a.replace(/(\r?\n)/g,l+"$1"+u):a)+l},a=t,s=r;return e&&(a=e.o+t,s=r+e.c),o(i,n),i.p={open:t,close:r,o:a,c:s,p:e},i.open=a,i.close=s,i},y=function(e=f){let t={Ansis:y,isSupported:()=>a,strip:e=>e.replace(/[][[()#;?]*(?:[0-9]{1,4}(?:;[0-9]{0,4})*)?[0-9A-ORZcf-nqry=><]/g,""),extend(e){for(let t in e){let n=e[t],o=(typeof n)[0],i="s"===o?A(...l(n)):n;d[t]="f"===o?{get(){return(...e)=>g(this,n(...e))}}:{get(){let e=g(this,i);return r(this,t,{value:e}),e}}}return o(t,n=i({},d)),t}},a=e>0,s=(e,t)=>a?{open:`[${e}m`,close:`[${t}m`}:h,u=e=>t=>e(...l(t)),m=(e,t)=>(n,r,o)=>s(`${e}8;2;${n};${r};${o}`,t),b=(e,t)=>(n,r,o)=>s(c(p(n,r,o))+e,t),E=e=>(t,n,r)=>e(p(t,n,r)),A=m(3,39),R=m(4,49),_=e=>s("38;5;"+e,39),x=e=>s("48;5;"+e,49);2===e?(A=E(_),R=E(x)):1===e&&(A=b(0,39),R=b(10,49),_=e=>s(c(e),39),x=e=>s(c(e)+10,49));let v,$={fg:_,bg:x,rgb:A,bgRgb:R,hex:u(A),bgHex:u(R),visible:h,reset:s(0,0),bold:s(1,22),dim:s(2,22),italic:s(3,23),underline:s(4,24),inverse:s(7,27),hidden:s(8,28),strikethrough:s(9,29)},C="Bright";return"black,red,green,yellow,blue,magenta,cyan,white,gray".split(",").map((e,t)=>{v="bg"+e[0].toUpperCase()+e.slice(1),8>t?($[e+C]=s(90+t,39),$[v+C]=s(100+t,49)):t=60,$[e]=s(30+t,39),$[v]=s(40+t,49)}),t.extend($)},m=new y;return M.exports=m,m.default=m,M.exports}());let{Ansis:B,fg:G,bg:U,rgb:j,bgRgb:F,hex:q,bgHex:K,reset:W,inverse:z,hidden:V,visible:X,bold:Q,dim:Y,italic:Z,underline:J,strikethrough:ee,black:et,red:en,green:er,yellow:eo,blue:ei,magenta:ea,cyan:es,white:eu,gray:el,redBright:ep,greenBright:ec,yellowBright:ef,blueBright:eh,magentaBright:ed,cyanBright:eg,whiteBright:ey,bgBlack:em,bgRed:eb,bgGreen:eE,bgYellow:eA,bgBlue:eR,bgMagenta:e_,bgCyan:ex,bgWhite:ev,bgGray:e$,bgRedBright:eC,bgGreenBright:ew,bgYellowBright:eO,bgBlueBright:eS,bgMagentaBright:ek,bgCyanBright:eI,bgWhiteBright:eT}=D,eN={REG_TYPE:"0",DIR_TYPE:"5",XHD_TYPE:"x"},eH={T_MAGIC:"ustar",T_VERSION:"00",WHITE_SPACE:32,NEGATIVE_256:255,POSITIVE_256:128},eL={INVALID_ENCODING_NAME:"Invalid name. Invalid name. Please check 'name' is a directory type.",INVALID_ENCODING_NAME_LEN:"Invalid name. Please check 'name' length is less than 255 byte.",INVALID_ENCODING_LINKNAME:"Invalid linkname. Please check 'linkname' length is less than 100 byte."},eP=new TextEncoder,eM=eP.encode.bind(eP);function eD(e,t){let n=e.toString(8);return t?n.length<=t?"0".repeat(t-n.length)+n+" ":"7".repeat(t)+" ":n}function eB(e,t){let n=" "+e+"="+t+"\n",r=eM(n);return r.length+String(r.length).length+n}function eG(e){let t=new Uint8Array(512),n=e.name;e.typeflag===eN.DIR_TYPE&&"/"!==n[n.length-1]&&(n+="/");let r="",o=!1;for(;n.length>100;){let e=n.indexOf("/");if(-1===e){o=!0;break}{let t=n.slice(0,e);r+=r?"/"+t:t,n=n.slice(e+1)}}if(o)throw Error(eL.INVALID_ENCODING_NAME);let i=eM(n);if(i.length+r.length>255)throw Error(eL.INVALID_ENCODING_NAME_LEN);if(e.linkname&&eM(e.linkname).length>100)throw Error(eL.INVALID_ENCODING_LINKNAME);if(t.set(i,0),t.set(eM(eD(e.mode,6)),100),t.set(eM(eD(e.uid,6)),108),t.set(eM(eD(e.gid,6)),116),e.size.toString(8).length>11){let n=e.size,r=[eH.POSITIVE_256];for(let e=11;e>0;e--)r[e]=n&eH.NEGATIVE_256,n=Math.floor(n/256);t.set(r,124)}else t.set(eM(eD(e.size,11)),124);return t.set(eM(eD(e.mtime,11)),136),t.set(eM(e.typeflag),156),e.linkname&&t.set(eM(e.linkname),157),t.set(eM(eH.T_MAGIC),257),t.set(eM(eH.T_VERSION),263),e.uname&&t.set(eM(e.uname),265),e.gname&&t.set(eM(e.gname),297),t.set(eM(eD(e.devmajor,6)),329),t.set(eM(eD(e.devminor,6)),337),r&&t.set(eM(r),345),t.set(eM(eD(t.subarray(0,512).reduce((e,t,n)=>n>=148&&n<156?e+eH.WHITE_SPACE:e+t,0),6)),148),t}function eU(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}let ej={HAS_DONE:"Can't add new entry after calling done()"},eF={mode:420,uid:0,gid:0,typeflag:eN.REG_TYPE,devmajor:0,devminor:0};class eq{resolveHeadOptions(e,t){let{filename:n,...r}=t;return{...eF,...r,name:n,mtime:Math.floor(Date.now()/1e3),size:e}}add(e,t){if(this.finished)throw Error(ej.HAS_DONE);let n=this.resolveHeadOptions(e.length,t);this.transport(e,n)}done(){this.finished||(this.finished=!0,this.reader.push(new Uint8Array(1024)),this.reader.push(null))}fix(e){let t=(512-e%512)%512;t>0&&this.reader.push(new Uint8Array(t))}transport(e,t){let n=e=>{if(t.pax){let e=function(e){let t="";if(t+=eB("path",e.name)+eB("linkpath",e.linkname),e.pax&&"object"==typeof e.pax)for(let n in e.pax)t+=eB(n,e.pax[n]);return eM(t)}({name:t.name,linkname:t.linkname||"",pax:{...t.pax}}),n=eG({...t,name:"pax_header",typeflag:eN.XHD_TYPE,size:e.length});this.reader.push(n),this.reader.push(e),this.reader.push(this.fix(e.length)),t.name="pax_header"}this.reader.push(eG(t)),this.reader.push(e)},r=new u({write:(e,t,r)=>{try{n(e),r()}catch(e){r(e)}},final:e=>{this.reader.push(this.fix(t.size)),e()}});r.write(e,e=>{e&&this.reader.emit("error",e)}),r.end()}get receiver(){return this.reader}constructor(){eU(this,"reader",void 0),eU(this,"finished",void 0),this.reader=new l({read(){}}),this.finished=!1}}function eK(e){return e.length}function eW(t,n,r){let o="function"==typeof n?n(t,r):n,{dir:i,base:a}=e.parse(t);return o.replace(/\[path\]/,i?i+"/":"").replace(/\[base\]/,a)}function ez(e){return/^\\\\\?\\/.test(e)?e:e.replace(/\\/g,"/")}async function eV(t){let n=await Promise.all((await a.readdir(t)).map(n=>e.join(t,n))),r=0,o=[];for(;r!==eK(n);){let t=n[r],i=await a.stat(t);if(i.isDirectory()){let r=await a.readdir(t);n.push(...r.map(n=>e.join(t,n)))}i.isFile()&&o.push(t),r++}return o}let eX=new TextEncoder;function eQ(e){return"string"==typeof e?eX.encode(e):e}function eY(){}async function eZ(e,t,n){try{return await t(e,n)}catch(e){return Promise.reject(e)}}let eJ={gzip:{level:c.constants.Z_BEST_COMPRESSION},brotliCompress:{params:{[c.constants.BROTLI_PARAM_QUALITY]:c.constants.BROTLI_MAX_QUALITY}},deflate:{level:c.constants.Z_BEST_COMPRESSION},deflateRaw:{level:c.constants.Z_BEST_COMPRESSION}};function e0(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class e1{enqueue(e){this.queue.push(e),this.run()}async run(){for(;this.running<this.maxConcurrent&&this.queue.length;){let e=this.queue.shift();this.running++;try{await e()}catch(e){this.errors.push(e)}finally{this.running--,this.run()}}}async wait(){for(;this.running;)await new Promise(e=>setTimeout(e,0));if(eK(this.errors))throw AggregateError(this.errors,"task failed")}constructor(e){e0(this,"maxConcurrent",void 0),e0(this,"queue",void 0),e0(this,"running",void 0),e0(this,"errors",void 0),this.maxConcurrent=e,this.queue=[],this.errors=[],this.running=0}}let e2="vite-plugin-compression",e3=(()=>{let e=s.cpus()||{length:1};return 1===e.length?10:Math.max(1,e.length-1)})();function e5(t){var n;let r=new Set,o=(t,n)=>ez(e.resolve(t,n));return(null==(n=t.build.rollupOptions)?void 0:n.output)?(Array.isArray(t.build.rollupOptions.output)?t.build.rollupOptions.output:[t.build.rollupOptions.output]).forEach(e=>{("object"!=typeof e||eK(Object.keys(e)))&&r.add(o(t.root,e.dir||t.build.outDir))}):r.add(o(t.root,t.build.outDir)),r}async function e6(t,n){let r=!("copyPublicDir"in t.build)||t.build.copyPublicDir;if(t.publicDir&&r&&i.existsSync(t.publicDir)){let r=await eV(t.publicDir),o=e.join(t.root,e.relative(t.root,t.publicDir));r.forEach(t=>{n(ez(e.relative(o,t)),t)})}}function e4(t={}){let n,{dest:r}=t,o=[],s=[],u=[],l=process.cwd(),p=function(){let t=new eq,n=[],r={dests:[],root:""};return{add:e=>{t.add(eQ(e.content),{filename:e.filename})},setup:t=>{Object.assign(r,t),r.dests.forEach(t=>{let o=ez(e.resolve(r.root,t+".tar")),a=ez(e.dirname(o));ez(r.root)!==a&&i.mkdirSync(a,{recursive:!0});let s=i.createWriteStream(o);n.push(s)})},done:async()=>{t.done(),await Promise.all(n.map(e=>new Promise((n,r)=>{e.on("error",r),e.on("finish",n),t.receiver.pipe(e)}))),n.length=0}}}(),c=new e1(e3);return{name:"vite-plugin-tarball",enforce:"post",async configResolved(e){s.push(...e5(e)),l=e.root,u=r?[r]:s,(n=e9.getPluginAPI(e.plugins))||await e6(e,e=>{o.push(e)}),p.setup({dests:u,root:l})},writeBundle(e,t){for(let e in t){let n=t[e];p.add({filename:e,content:"asset"===n.type?n.source:n.code})}},async closeBundle(){for(let t of(n&&await n.done,!o.length&&n&&n.staticOutputs.size&&o.push(...n.staticOutputs),s))for(let n of o)c.enqueue(async()=>{let r=e.join(t,n),o=await a.readFile(r);p.add({filename:n,content:o})});await c.wait(),await p.done()}}}function e9(t={}){let n,{include:r=/\.(html|xml|css|json|js|mjs|svg|yaml|yml|toml)$/,exclude:o,threshold:i=0,algorithms:s=["gzip","brotliCompress"],filename:u,deleteOriginalAssets:l=!1,skipIfLargerOrEqual:f=!0}=t,h=[];s.forEach(e=>{"string"==typeof e?h.push(e8(e)):"object"==typeof e&&Array.isArray(e)&&h.push(e)});let d=P(r,o),g=[],y=[],{msgs:m,cleanup:b}=function(){let e=[],t=process.stdout.write.bind(process.stdout);return process.stdout.write=function(...n){let[r]=n,o="string"==typeof r?r:r.toString();return o.includes("built in")?(e.push(o),!1):t.apply(this,n)},{cleanup:()=>process.stdout.write=t,msgs:e}}(),E=process.cwd(),A=h.map(([e,t])=>({algorithm:"string"==typeof e?function(e){let t=e in c?e:"gzip";return{algorithm:p.promisify(c[t])}}(e).algorithm:e,options:t,filename:null!=u?u:"brotliCompress"===e?"[path][base].br":"[path][base].gz"})),R=new e1(e3),_=async function(e,t){for(let e in t){if(!d(e))continue;let n=t[e],r=eQ("asset"===n.type?n.source:n.code),o=eK(r);o<i||R.enqueue(async()=>{for(let n=0;n<A.length;n++){let i=A[n],a=n===A.length-1,s=eW(e,i.filename,{options:i.options,algorithm:i.algorithm}),u=await eZ(r,i.algorithm,i.options);if(f&&eK(u)>=o)return;a&&(l||e===s)&&Reflect.deleteProperty(t,e),this.emitFile({type:"asset",fileName:s,source:u})}})}await R.wait().catch(this.error)},x={resolve:eY},v={staticOutputs:new Set,done:new Promise(e=>{x.resolve=e})},$=new Intl.NumberFormat("en",{maximumFractionDigits:2,minimumFractionDigits:2}),C=e=>`${$.format(e/1e3)} kB`;return{name:e2,apply:"build",enforce:"post",api:v,async configResolved(e){y.push(...e5(e)),await e6(e,e=>{g.push(e)});let t=e.plugins.find(e=>"vite:build-import-analysis"===e.name);if(!t)throw Error("[vite-plugin-compression] Can't be work in versions lower than vite at 2.0.0");let r=t.generateBundle;if("object"==typeof r&&r.handler){let e=r.handler;r.handler=async function(...t){await e.apply(this,t),await _.apply(this,t)}}"function"==typeof r&&(t.generateBundle=async function(...e){await r.apply(this,e),await _.apply(this,e)}),n=e.logger,E=e.root},async closeBundle(){let t=[],r=async(n,r,o)=>{let i=await a.readFile(n);for(let s=0;s<A.length;s++){let u=A[s],p=s===A.length-1,c=await eZ(i,u.algorithm,u.options);if(f&&eK(c)>=eK(i)){v.staticOutputs.has(r)||v.staticOutputs.add(r);return}let h=eW(r,u.filename,{options:u.options,algorithm:u.algorithm});v.staticOutputs.has(h)||v.staticOutputs.add(h);let d=e.join(o,h);p&&l&&d!==n&&await a.rm(n,{recursive:!0,force:!0}),await a.writeFile(d,c),t.push({dest:e.relative(E,o)+"/",file:h,size:eK(c)})}},o=async(t,n)=>{let o=e.join(t,n);if(!d(o)&&!v.staticOutputs.has(n))return void v.staticOutputs.add(n);let{size:s}=await a.stat(o);if(s<i){v.staticOutputs.has(n)||v.staticOutputs.add(n);return}await r(o,n,t)};for(let e of y)for(let t of g)R.enqueue(()=>o(e,t));if(await R.wait().catch(e=>e),x.resolve(),b(),n){let e=t.reduce((e,t)=>Math.max(e,(t.dest+t.file).length),0);for(let{dest:r,file:o,size:i}of t){let t=o.padEnd(e);n.info(D.dim(r)+D.green(t)+D.bold(D.dim(C(i))))}}for(let e of m)console.info(e)}}}function e8(e,t){if("string"==typeof e){if(e in eJ){let n={...eJ[e]};return t&&Object.assign(n,t),[e,n]}throw Error(`[vite-plugin-compression] Unsupported algorithm: ${e}`)}return[e,t||{}]}e9.getPluginAPI=e=>{var t;return null==(t=e.find(e=>e.name===e2))?void 0:t.api};export{e9 as compression,e9 as default,e8 as defineAlgorithm,e4 as tarball};
